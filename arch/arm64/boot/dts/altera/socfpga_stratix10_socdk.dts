/*
 * Copyright Altera Corporation (C) 2015. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms and conditions of the GNU General Public License,
 * version 2, as published by the Free Software Foundation.
 *
 * This program is distributed in the hope it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 * more details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "socfpga_stratix10.dtsi"
#include <dt-bindings/interrupt-controller/irq.h>

/ {
	model = "SoCFPGA Stratix 10 SoCDK";

	aliases {
		serial0 = &uart0;
		ethernet0 = &gmac0;
		ethernet1 = &gmac1;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};

	memory {
		device_type = "memory";
		/* We expect the bootloader to fill in the reg */
		reg = <0 0 0 0>;
	};

	ref_033v: 033-v-ref {
		compatible = "regulator-fixed";
		regulator-name = "0.33V";
		regulator-min-microvolt = <330000>;
		regulator-max-microvolt = <330000>;
	};

	soc {
		clocks {
			osc1 {
				clock-frequency = <125000000>;
			};
		};

		s10_hps_bridges: bridge@80000000 {
			compatible = "altr,bridge-19.1", "simple-bus";
			reg =   <0x80000000 0x00008000>;
			reg-names = "axi_h2f";
			//clocks = <&iopll_0 1 &clk_0 &dp_0_video_pll 3 &iopll_0 0>;
			//clock-names = "h2f_axi_clock", "h2f_lw_axi_clock", "f2sdram0_clock", "f2sdram2_clock";
			#address-cells = <2>;
			#size-cells = <1>;
			#clock-cells = <0>;
			ranges = <0x00000000 0x00000000 0x80006000 0x00000040>,
				 <0x00000000 0x00000040 0x80006040 0x00000008>;

			gmii_to_sgmii: phy@0x000000040 {
				compatible = "altr,gmii-to-sgmii-2.0";
				reg = <0x00000000 0x00000000 0x00000040>,
				      <0x00000000 0x00000040 0x00000008>;
				reg-names = "eth_tse_control_port", "gmii_to_sgmii_adapter_avalon_slave";
				//clocks = <&sgmii_1_clk_0 &gmac1 1 &sgmii_1_clk_125 &sgmii_1_clk_125>;
				//clocks = <&sgmii_1_clk_0 &clkmgr STRATIX10_EMAC1_CLK &sgmii_1_clk_125 &sgmii_1_clk_125>;
				//clock-names = "clock_in", "emac_gtx_clk", "tse_pcs_ref_clk_clock_connection", "tse_rx_cdr_refclk";
			}; //end phy@0x100000040 (gmii_to_sgmii)

		};


		socfpga_axi_setup: stmmac-axi-config {
			snps,wr_osr_lmt = <0x0000000f>; /* appended from boardinfo */
			snps,rd_osr_lmt = <0x0000000f>; /* appended from boardinfo */
			snps,blen = <0 0 0 0 16 0 0>;   /* appended from boardinfo */
		}; //end stmmac-axi-config (socfpga_axi_setup)

		firmware {
			svc {
				rsu {
					compatible = "intel,stratix10-rsu";
				};
			};
		};

	};
};

&gpio0 {
	status = "okay";
};

&gpio1 {
	status = "okay";
};

&gmac0 {
	status = "okay";
	phy-mode = "rgmii";
	phy-handle = <&phy0>;
	altr,sysmgr-syscon = <&sysmgr 0x00000044 0>;
	max-frame-size = <9000>;

	mdio0 {
		#address-cells = <1>;
		#size-cells = <0>;
		compatible = "snps,dwmac-mdio";
		phy0: ethernet-phy@0 {
			reg = <4>;

			/*
			 * All skews are offset since hardware skew values for the ksz9031
			 * range from a negative skew to a positive skew.
			 * See the micrel-ksz90x1.txt Documentation file for details.
			 */
			 txd0-skew-ps = <0>; /* -420ps */
			 txd1-skew-ps = <0>; /* -420ps */
			 txd2-skew-ps = <0>; /* -420ps */
			 txd3-skew-ps = <0>; /* -420ps */
			 txen-skew-ps = <0>; /* -420ps */
			 txc-skew-ps  = <1860>; /* 960ps */

			 rxd0-skew-ps = <720>; /*  300ps */
			 rxd1-skew-ps = <720>; /*  300ps */
			 rxd2-skew-ps = <720>; /*  300ps */
			 rxd3-skew-ps = <720>; /*  300ps */
			 rxdv-skew-ps = <720>; /*  300ps */
			 rxc-skew-ps  = <0>;   /* -900ps */
		};
	};
};


&gmac1 {
	compatible = "altr,socfpga-stmmac", "snps,dwmac-3.74a", "snps,dwmac";
	reg = <0xff802000 0x2000>;
	interrupts = <0 91 4>;
	interrupt-names = "macirq";
	mac-address = [00 00 00 00 00 00];
	resets = <&rst EMAC1_RESET>, <&rst EMAC1_OCP_RESET>;
	reset-names = "stmmaceth", "stmmaceth-ocp";
	clocks = <&clkmgr STRATIX10_EMAC1_CLK>;
	clock-names = "stmmaceth";
	tx-fifo-depth = <16384>;
	rx-fifo-depth = <16384>;
	snps,multicast-filter-bins = <256>;
	altr,sysmgr-syscon = <&sysmgr 0x48 0>;
	snps,perfect-filter-entries = <128>;
	altr,gmii-to-sgmii-converter = <&gmii_to_sgmii>;
	altr,gmii_to_sgmii_converter = <&gmii_to_sgmii>;
	phy-mode = "sgmii";
	address-bits = <48>;
	max-frame-size = <9000>;
	snps,axi-config = <&socfpga_axi_setup>;
	status = "okay";
};

&mmc {
	status = "okay";
	cap-sd-highspeed;
	broken-cd;
	bus-width = <4>;
};

&uart0 {
	status = "okay";
};

&uart1 {
	status = "disabled";
};

&usb0 {
	status = "okay";
	disable-over-current;
};

&usb1 {
	status = "disabled";
	disable-over-current;
};

&watchdog0 {
	status = "okay";
};

&i2c3 {
	status = "okay";
	clock-frequency = <100000>;
	i2c-sda-hold-time-ns = <100>;
	i2c-sda-falling-time-ns = <300>;  /* hcnt */
	i2c-sdl-falling-time-ns = <300>;  /* lcnt */

	pca9539@74 {
		compatible = "nxp,pca9539";
		reg = <0x74>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	rtc@68 {
		compatible = "dallas,ds1308";
		reg = <0x68>;
	};

	ads1015@4b {
		compatible = "ti,ads1015";
		reg = <0x4b>;
		#address-cells = <0x1>;
		#size-cells = <0x0>;
		status = "okay";

		channel@4 {
			reg = <0x4>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@5 {
			reg = <0x5>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@6 {
			reg = <0x6>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@7 {
			reg = <0x7>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};
	};
};

&i2c4 {
	status = "okay";
	clock-frequency = <100000>;
	i2c-sda-hold-time-ns = <100>;
	i2c-sda-falling-time-ns = <300>;  /* hcnt */
	i2c-sdl-falling-time-ns = <300>;  /* lcnt */

	ads1015@49 {
		compatible = "ti,ads1015";
		reg = <0x49>;
		#address-cells = <0x1>;
		#size-cells = <0x0>;
		status = "okay";

		channel@4 {
			reg = <0x4>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@5 {
			reg = <0x5>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@6 {
			reg = <0x6>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};

		channel@7 {
			reg = <0x7>;
			ti,gain = <0x1>;
			ti,datarate = <0x4>;
		};
	};
};

&i2c1 {
	status = "okay";
	clock-frequency = <100000>;
	i2c-sda-hold-time-ns = <100>;
	i2c-sda-falling-time-ns = <300>;  /* hcnt */
	i2c-sdl-falling-time-ns = <300>;  /* lcnt */

	pca9539@74 {
		compatible = "nxp,pca9539";
		reg = <0x74>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	pca9539@75 {
		compatible = "nxp,pca9539";
		reg = <0x75>;
		gpio-controller;
		#gpio-cells = <2>;
	};

	pca9539@76 {
		compatible = "nxp,pca9539";
		reg = <0x76>;
		gpio-controller;
		#gpio-cells = <2>;
	};

};

&qspi {
	status = "okay";
	flash@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "n25q00a";
		reg = <0>;
		spi-max-frequency = <50000000>;

		m25p,fast-read;
		cdns,page-size = <256>;
		cdns,block-size = <16>;
		cdns,read-delay = <1>;
		cdns,tshsl-ns = <50>;
		cdns,tsd2d-ns = <50>;
		cdns,tchsh-ns = <4>;
		cdns,tslch-ns = <4>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			qspi_boot: partition@0 {
				label = "Boot and fpga data";
				reg = <0x0 0x40000000>;
			};
		};
	};
};
